<p class="govuk-body">
  <%= pluralize(number_with_delimiter(@users.total_count), "user") %> found
  <%= link_to "Export as CSV", request.query_parameters.merge(format: "csv"), class: "govuk-link" %>
<p>

<%= GovukPublishingComponents::AppHelpers::TableHelper.helper(self, "Users", { sortable: false, caption_classes: "govuk-visually-hidden" }) do |t| %>
  <%= t.head do %>
    <%= t.header "Name, email, role, organisation" %>
    <%= t.header "Last sign-in" %>
    <%= t.header "Created" %>
    <%= t.header "Status" %>
  <% end %>

  <%= t.body do %>
    <% @users.each do |user| %>
      <%= t.row do %>
        <% name = capture do %>
          <strong>
            <%= link_to user.name, edit_user_path(user), class: "govuk-link #{user.unusable_account? ? "app-user--unusable" : nil}" %><br/>
          </strong>

          <%= user.email %><br/>
          <%= user.role.humanize %><br/>
          <%= user.organisation.try(:name) %>
        <% end %>

        <%= t.cell name %>
        <%= t.cell user.current_sign_in_at ? time_ago_in_words(user.current_sign_in_at) + " ago" : nil %>
        <%= t.cell time_ago_in_words(user.created_at) + " ago" %>

        <% status_and_actions = capture do %>
          <%= user.status.humanize %>
        <% end %>

        <%= t.cell status_and_actions %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<% pages = { } %>

<% pages[:previous_page] = { url: users_path({}.merge(page: @users.prev_page)),
                             label: "Previous",
                             title: "Previous page" } if @users.prev_page %>

<% pages[:next_page] = { url: users_path({}.merge(page: @users.next_page)),
                         label: "Next",
                         title: "Next page" } if @users.next_page %>

<%= render "govuk_publishing_components/components/previous_and_next_navigation", pages %>
